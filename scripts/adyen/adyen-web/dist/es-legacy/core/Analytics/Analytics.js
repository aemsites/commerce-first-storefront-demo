import t from"../Services/analytics/collect-id.js";import e from"./EventsQueue.js";import{ANALYTICS_EVENT_INFO as n,ANALYTICS_INFO_TIMER_INTERVAL as a,ANALYTICS_EVENT_LOG as l,ANALYTICS_EVENT_ERROR as o,ANALYTICS_PATH as c}from"./constants.js";import{debounce as r}from"../../utils/debounce.js";import{processAnalyticsData as s,createAnalyticsObject as i}from"./utils.js";import{analyticsPreProcessor as u}from"./analyticsPreProcessor.js";function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),a.forEach((function(e){y(t,e,n[e])}))}return t}let d=null,f=null;const b=({locale:y,clientKey:b,analytics:p,amount:j,analyticsContext:g,bundleType:h})=>{const v=m({},{enabled:!0,checkoutAttemptId:null,analyticsData:{}},p),O=t({analyticsContext:g,clientKey:b,locale:y,amount:j,analyticsPath:c,bundleType:h}),P=e({analyticsContext:g,clientKey:b,analyticsPath:c}),w=()=>d?P.run(d):Promise.resolve(null),A={setUp:async t=>{const{payload:e}=v,n=s(v.analyticsData);if(!d)try{const a=await O(m({},t,e&&m({},e),Object.keys(n).length&&m({},n)));d=a}catch(t){console.warn("Fetching checkoutAttemptId failed."+(t?` Error=${t}`:""))}},getCheckoutAttemptId:()=>d,getEventsQueue:()=>P,createAnalyticsEvent:({event:t,data:e})=>{if(!v.enabled)return;const c=i(m({event:t},e));return((t,e)=>{const c=t===n?t:`${t}s`;P.add(`${c}`,e),t===n&&(clearTimeout(f),f=setTimeout((()=>{w()}),a)),t!==l&&t!==o||(clearTimeout(f),r(w)())})(t,c),c},getEnabled:()=>v.enabled,sendAnalytics:null};return A.sendAnalytics=!0===v.enabled?u(A):()=>{},A};export{b as default};
//# sourceMappingURL=Analytics.js.map
