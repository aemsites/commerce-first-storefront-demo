{"version":3,"file":"ThreeDS2Challenge.js","sources":["../../../../src/components/ThreeDS2/ThreeDS2Challenge.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport PrepareChallenge from './components/Challenge';\nimport { DEFAULT_CHALLENGE_WINDOW_SIZE, THREEDS2_CHALLENGE, THREEDS2_CHALLENGE_ERROR, THREEDS2_ERROR, THREEDS2_FULL } from './constants';\nimport { existy } from '../../utils/commonUtils';\nimport { hasOwnProperty } from '../../utils/hasOwnProperty';\nimport { TxVariants } from '../tx-variants';\nimport { ThreeDS2ChallengeConfiguration } from './types';\nimport AdyenCheckoutError, { API_ERROR } from '../../core/Errors/AdyenCheckoutError';\nimport { ANALYTICS_API_ERROR, Analytics3DS2Errors, ANALYTICS_RENDERED_STR, Analytics3DS2Events } from '../../core/Analytics/constants';\nimport { SendAnalyticsObject } from '../../core/Analytics/types';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport { ActionHandledReturnObject } from '../../types/global-types';\n\nclass ThreeDS2Challenge extends UIElement<ThreeDS2ChallengeConfiguration> {\n    public static type = TxVariants.threeDS2Challenge;\n\n    public static defaultProps = {\n        dataKey: 'threeDSResult',\n        size: DEFAULT_CHALLENGE_WINDOW_SIZE,\n        type: THREEDS2_CHALLENGE\n    };\n\n    protected submitAnalytics = (aObj: SendAnalyticsObject) => {\n        if (aObj.type === ANALYTICS_RENDERED_STR) return; // suppress the rendered event (it will have the same timestamp as the \"creq sent\" event)\n\n        super.submitAnalytics(aObj);\n    };\n\n    protected onActionHandled = (rtnObj: ActionHandledReturnObject) => {\n        this.submitAnalytics({\n            type: THREEDS2_FULL,\n            message: rtnObj.actionDescription,\n            subtype: Analytics3DS2Events.CHALLENGE_IFRAME_LOADED\n        });\n\n        super.onActionHandled(rtnObj);\n    };\n\n    onComplete(state) {\n        /**\n         * Equals a call to onAdditionalDetails (as set in actionTypes.ts) for the regular, \"native\" flow.\n         * However, if the action to create this component came from the 3DS2InMDFlow process it will instead equal a call to the onComplete callback\n         * (as defined in the 3DS2InMDFlow and passed in as a config prop).\n         */\n        if (state) super.onComplete(state);\n        this.unmount(); // re. fixing issue around back to back challenge calls\n    }\n\n    render() {\n        // existy used because threeds2InMDFlow will send empty string for paymentData and we should be allowed to proceed with this\n        if (!existy(this.props.paymentData)) {\n            /**\n             *   The presence of props.isMDFlow indicates the action to create this component came from the threeds2InMDFlow process which passes (an empty) paymentsData.\n             *   The regular, \"native\" flow uses the authorisationToken from the 3DS2 action, which actionTypes.ts assigns to a property called paymentData\n             */\n            const dataTypeForError = hasOwnProperty(this.props, 'isMDFlow') ? 'paymentData' : 'authorisationToken';\n\n            this.props.onError(new AdyenCheckoutError(API_ERROR, `No ${dataTypeForError} received. 3DS2 Challenge cannot proceed`));\n\n            this.submitAnalytics({\n                type: THREEDS2_ERROR,\n                code: Analytics3DS2Errors.ACTION_IS_MISSING_PAYMENT_DATA,\n                errorType: ANALYTICS_API_ERROR,\n                message: `${THREEDS2_CHALLENGE_ERROR}: Missing 'paymentData' property from threeDS2 action`\n            });\n\n            return null;\n        }\n\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <PrepareChallenge\n                    {...this.props}\n                    onComplete={this.onComplete}\n                    onSubmitAnalytics={this.submitAnalytics}\n                    isMDFlow={this.props.paymentData.length < 15}\n                    onActionHandled={this.onActionHandled}\n                />\n            </CoreProvider>\n        );\n    }\n}\n\nexport default ThreeDS2Challenge;\n"],"names":["ThreeDS2Challenge","UIElement","onComplete","state","super","this","unmount","render","existy","props","paymentData","dataTypeForError","hasOwnProperty","onError","AdyenCheckoutError","API_ERROR","submitAnalytics","type","THREEDS2_ERROR","code","Analytics3DS2Errors","ACTION_IS_MISSING_PAYMENT_DATA","errorType","ANALYTICS_API_ERROR","message","THREEDS2_CHALLENGE_ERROR","h","CoreProvider","i18n","loadingContext","resources","PrepareChallenge","onSubmitAnalytics","isMDFlow","length","onActionHandled","_define_property","aObj","ANALYTICS_RENDERED_STR","rtnObj","THREEDS2_FULL","actionDescription","subtype","Analytics3DS2Events","CHALLENGE_IFRAME_LOADED","TxVariants","threeDS2Challenge","defaultProps","dataKey","size","DEFAULT_CHALLENGE_WINDOW_SIZE","THREEDS2_CHALLENGE"],"mappings":"swCAcA,MAAMA,UAA0BC,EAyB5BC,UAAAA,CAAWC,GAMHA,GAAOC,MAAMF,WAAWC,GAC5BE,KAAKC,SACT,CAEAC,MAAAA,GAEI,IAAKC,EAAOH,KAAKI,MAAMC,aAAc,CAKjC,MAAMC,EAAmBC,EAAeP,KAAKI,MAAO,YAAc,cAAgB,qBAWlF,OATAJ,KAAKI,MAAMI,QAAQ,IAAIC,EAAmBC,EAAW,MAAMJ,8CAE3DN,KAAKW,gBAAgB,CACjBC,KAAMC,EACNC,KAAMC,EAAoBC,+BAC1BC,UAAWC,EACXC,QAAS,GAAGC,2DAGT,IACX,CAEA,OACIC,EAACC,EAAAA,CAAaC,KAAMvB,KAAKI,MAAMmB,KAAMC,eAAgBxB,KAAKI,MAAMoB,eAAgBC,UAAWzB,KAAKyB,WAC5FJ,EAACK,EAAAA,wUAAAA,CAAAA,GACO1B,KAAKI,OAAK,CACdP,WAAYG,KAAKH,WACjB8B,kBAAmB3B,KAAKW,gBACxBiB,SAAU5B,KAAKI,MAAMC,YAAYwB,OAAS,GAC1CC,gBAAiB9B,KAAK8B,mBAItC,+BA1DAC,EAAA/B,KAAUW,mBAAmBqB,IACrBA,EAAKpB,OAASqB,GAElBlC,MAAMY,gBAAgBqB,EAAAA,IAG1BD,EAAA/B,KAAU8B,mBAAmBI,IACzBlC,KAAKW,gBAAgB,CACjBC,KAAMuB,EACNhB,QAASe,EAAOE,kBAChBC,QAASC,EAAoBC,0BAGjCxC,MAAM+B,gBAAgBI,EAAAA,KArB1BH,EADEpC,EACYiB,OAAO4B,EAAWC,mBAEhCV,EAHEpC,EAGY+C,eAAe,CACzBC,QAAS,gBACTC,KAAMC,EACNjC,KAAMkC"}